---
title: "The condition of COVID-19 in Portugal"
description: |
  A brief summary of the COVID-19 condition in Portugal.
author:
  - name: Xinying Xu
    url: https://example.com/norajones
date: 08-28-2021
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, error = FALSE, message = FALSE, warning = FALSE)
```

```{r}
library(tidyverse)
library(tsibble)
library(lubridate)
library(DT)
library(plotly)
```

# Data description

The dataset contains the variables about the accumulated confirmed amount, accumulated recovered amount amount and accumulated dead amount, from the beginning of the outbreak to the present. You can find the data from the github of [JOHNS HOPKINS](https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series), which supports the worldwide data of COVID-19, in this blog, I only analyse Portugal. And after wangling data, I use `tsibble::difference` to add some variables holds in information of the new daily cases: new confirmed, new recovered and new dead amount. 

The table below records the cases which related the COVID-19, it's designed to explore data by yourself. Let's try!

```{r}
# get the COVID-19 data in Portugal.
pt_comfirmed <- read_csv(here::here("data/confirmed_global.csv")) %>% 
  rename( Country = "Country/Region") %>% 
  filter(Country == "Portugal") %>%
  select(-`Province/State`) %>% 
  pivot_longer(cols = c(-Country:-Long),
               names_to = "Date",
               values_to = "Accumulated_comfirmed")
```

```{r}
pt_recovered <- read_csv(here::here("data/recovered_global.csv")) %>% 
  rename( Country = "Country/Region") %>% 
  filter(Country == "Portugal") %>%
  select(-`Province/State`) %>% 
  pivot_longer(cols = c(-Country:-Long),
               names_to = "Date",
               values_to = "Accumulated_recovered")
```

```{r}
pt_dead <- read_csv(here::here("data/deaths_global.csv")) %>% 
  rename( Country = "Country/Region") %>% 
  filter(Country == "Portugal") %>%
  select(-`Province/State`) %>% 
  pivot_longer(cols = c(-Country:-Long),
               names_to = "Date",
               values_to = "Accumulated_dead")
```

```{r}
newly_pt <- read_csv(here::here("data/newly-cases.csv")) %>% 
  rename( country = "countriesAndTerritories") %>% 
  filter(country == "Portugal")
```

```{r}
# combine them together
combined_pt <- pt_comfirmed %>% 
  full_join(pt_recovered, by = c("Country", "Lat","Long","Date")) %>% 
  full_join(pt_dead, by = c("Country", "Lat","Long","Date")) %>%
  select(-Country: -Long) %>% 
  mutate(New_confirmed = difference(Accumulated_comfirmed, default = 0),
         New_recovered = difference(Accumulated_recovered, default = 0),
         New_dead = difference(Accumulated_dead, default = 0)) %>% 
  mutate(Date = mdy(Date),
         Date = as.Date(Date,format = "%Y-%m-%d"))
```

```{r}
datatable(combined_pt, 
          filter = "top",
          rownames = FALSE,
          class="stripe hover",
          colnames = c("Date",
                       "Comfirmed", 
                       "Recoverd", 
                       "Dead",
                       "New Comfirmed",
                       "New Recovered",
                       "New Dead"),
          caption = "Table1: The overall COVID-19 data in Portugal") 

```

# Exploratory data analysis
### The summary of COVID-19 cases in Portugal

It can seen directly from the plot, although there are still confirmed cases everyday, corresponding with a high recovery rate, which must be related with popularization of vaccines, we'll talk about it in the next part. In addition, we might occur some outliers, the value of the new confirmed variable suddenly be zero, it doesn't make sense that recovery rate is zero, just ignore this issue.

```{r}
# plot the newly reported condition, covering the period in the recent 3 months.
pt_plot <- combined_pt %>%
  select(-Accumulated_comfirmed, -Accumulated_recovered, -Accumulated_dead) %>% 
  mutate(Year = year(Date),
         Month = month(Date),
         Day = day(Date)) %>% 
  filter(Year == 2021 & (Month == 6 | Month == 7 | Month == 8)) %>% 
  select(-Year:-Day)
```

```{r}
plot <- ggplot(pt_plot) +
  geom_line(aes(x = Date, y = log(New_confirmed)),
            bin = 50, 
            color = "#84142D", 
            alpha = 0.8, 
            size = .5)+
  geom_line(aes(x = Date, y = log(New_recovered)),
            bin = 100, 
            color = "#FEA82F", 
            alpha = 0.8,
            size = .5, 
            linetype = "dot")+
  geom_col(aes(x = Date, y = log(New_dead)),
           fill = "#C4B6B6")+
  theme_bw()+
  xlab("Date(2021)")+
  ylab("Amount")+
  labs(title = "The trend of COVID-19 in recent 3 months in Portugal.")

ggplotly(plot)
```

